apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: production

resources:
  - ../base/deployment.yaml
  - ../base/service.yaml
  - ../base/hpa.yaml
  - ../base/serviceaccount.yaml
  - blue-deployment.yaml
  - green-deployment.yaml

images:
  - name: ghcr.io/catbird/mls-server
    newTag: latest

replicas:
  - name: mls-server
    count: 3

patchesStrategicMerge:
  - |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: mls-server
    spec:
      template:
        spec:
          containers:
            - name: mls-server
              env:
                - name: RUST_LOG
                  value: "warn"  # Production: warn only (errors and warnings)
              resources:
                requests:
                  cpu: 250m
                  memory: 512Mi
                limits:
                  cpu: 1000m
                  memory: 1Gi

configMapGenerator:
  - name: mls-config
    literals:
      - ENVIRONMENT=production
