# Docker Compose Environment Configuration
# Copy this file to .env and update with your values

# PostgreSQL Configuration
POSTGRES_PASSWORD=changeme_secure_password
POSTGRES_USER=catbird
POSTGRES_DB=catbird

# Redis Configuration
REDIS_PASSWORD=changeme_redis_password

# Application Configuration
JWT_SECRET=your-jwt-secret-key-change-in-production

# Logging Configuration
# CRITICAL: Always set RUST_LOG=warn in production
# Higher log levels leak identity-bearing metadata:
#   - info: Logs operational detail that may expose patterns
#   - debug: May log hashed IDs (for debugging only)
#   - trace: Development only, never in production
#
# Safe production values:
#   - warn: Recommended (errors and warnings only)
#   - error: Ultra-minimal (errors only)
#
# For targeted debugging in production:
#   RUST_LOG=warn,catbird_server::handlers::send_message=debug
#
# Default behavior (if RUST_LOG not set):
#   - Debug builds: debug level
#   - Release builds: warn level
RUST_LOG=warn

DATABASE_URL=postgresql://catbird:changeme_secure_password@postgres:5432/catbird
TEST_DATABASE_URL=postgresql://catbird:changeme_secure_password@postgres:5432/catbird_test
REDIS_URL=redis://:changeme_redis_password@redis:6379

# Server Configuration
SERVER_PORT=3000

# Service DID for inter-service JWT aud validation
SERVICE_DID=did:web:mls.example.com
# Optional: fallback proxy target for non-local /xrpc calls
PDS_XRPC_BASE=https://bsky.social

# Data Retention (Compaction Worker)
# How long to keep messages before deletion (in days)
MESSAGE_TTL_DAYS=30
# How long to keep event stream entries before deletion (in days)
EVENT_STREAM_TTL_DAYS=7

# Key Package Limits (Cleanup Worker)
# Maximum number of key packages allowed per device
MAX_KEY_PACKAGES_PER_DEVICE=200

# Rate Limiting Configuration
# Per-IP rate limiting (unauthenticated requests)
RATE_LIMIT_IP_PER_MINUTE=60          # Requests per minute per IP
IP_RATE_BURST=6                       # Burst capacity (defaults to 10% of per-minute)

# Per-DID endpoint-specific rate limiting (authenticated requests)
RATE_LIMIT_SEND_MESSAGE=100           # High frequency messaging (per DID per minute)
RATE_LIMIT_PUBLISH_KEY_PACKAGE=20     # Batch key package uploads (per DID per minute)
RATE_LIMIT_ADD_MEMBERS=10             # Admin operations: add members (per DID per minute)
RATE_LIMIT_CREATE_CONVO=5             # Expensive: create conversation (per DID per minute)
RATE_LIMIT_REPORT_MEMBER=5            # Prevent report spam (per DID per minute)
RATE_LIMIT_DID_DEFAULT=200            # Default for other operations (per DID per minute)
