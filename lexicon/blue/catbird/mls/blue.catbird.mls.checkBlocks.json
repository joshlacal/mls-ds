{
  "lexicon": 1,
  "id": "blue.catbird.mls.checkBlocks",
  "description": "Check Bluesky block relationships between users for MLS conversation moderation",
  "defs": {
    "main": {
      "type": "query",
      "description": "Query Bluesky social graph to check block status between users. Returns block relationships relevant to MLS conversation membership. Server queries Bluesky PDS for current block state. Used before adding members to prevent blocked users from joining the same conversation.",
      "parameters": {
        "type": "params",
        "required": ["dids"],
        "properties": {
          "dids": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "did"
            },
            "description": "DIDs to check for mutual blocks (2-100 users)",
            "minLength": 2,
            "maxLength": 100
          }
        }
      },
      "output": {
        "encoding": "application/json",
        "schema": {
          "type": "object",
          "required": ["blocks", "checkedAt"],
          "properties": {
            "blocks": {
              "type": "array",
              "items": {
                "type": "ref",
                "ref": "#blockRelationship"
              },
              "description": "List of block relationships between the provided DIDs"
            },
            "checkedAt": {
              "type": "string",
              "format": "datetime",
              "description": "When the block status was checked (for cache invalidation)"
            }
          }
        }
      },
      "errors": [
        {
          "name": "TooManyDids",
          "description": "Too many DIDs provided (max 100)"
        },
        {
          "name": "BlueskyServiceUnavailable",
          "description": "Could not reach Bluesky service to check blocks"
        }
      ]
    },
    "blockRelationship": {
      "type": "object",
      "description": "Represents a block relationship between two users on Bluesky",
      "required": ["blockerDid", "blockedDid", "createdAt"],
      "properties": {
        "blockerDid": {
          "type": "string",
          "format": "did",
          "description": "DID of user who created the block"
        },
        "blockedDid": {
          "type": "string",
          "format": "did",
          "description": "DID of user who was blocked"
        },
        "createdAt": {
          "type": "string",
          "format": "datetime",
          "description": "When the block was created on Bluesky"
        },
        "blockUri": {
          "type": "string",
          "format": "at-uri",
          "description": "AT-URI of the block record on Bluesky (for verification)"
        }
      }
    }
  }
}
