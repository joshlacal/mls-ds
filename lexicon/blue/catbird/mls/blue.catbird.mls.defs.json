{
  "lexicon": 1,
  "id": "blue.catbird.mls.defs",
  "defs": {
    "convoView": {
      "type": "object",
      "description": "View of an MLS conversation",
      "required": ["id", "groupId", "creator", "members", "epoch", "createdAt"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Conversation identifier (TID)"
        },
        "groupId": {
          "type": "string",
          "description": "MLS group identifier (hex-encoded)",
          "maxLength": 128
        },
        "creator": {
          "type": "string",
          "format": "did",
          "description": "DID of the conversation creator"
        },
        "members": {
          "type": "array",
          "items": {
            "type": "ref",
            "ref": "#memberView"
          },
          "description": "Current conversation members"
        },
        "epoch": {
          "type": "integer",
          "minimum": 0,
          "description": "Current MLS epoch number"
        },
        "cipherSuite": {
          "type": "string",
          "description": "MLS cipher suite used",
          "enum": [
            "MLS_128_DHKEMX25519_AES128GCM_SHA256_Ed25519",
            "MLS_128_DHKEMP256_AES128GCM_SHA256_P256",
            "MLS_128_DHKEMX25519_CHACHA20POLY1305_SHA256_Ed25519",
            "MLS_256_DHKEMX448_AES256GCM_SHA512_Ed448",
            "MLS_256_DHKEMP521_AES256GCM_SHA512_P521",
            "MLS_256_DHKEMX448_CHACHA20POLY1305_SHA512_Ed448"
          ]
        },
        "createdAt": {
          "type": "string",
          "format": "datetime",
          "description": "Conversation creation timestamp"
        },
        "lastMessageAt": {
          "type": "string",
          "format": "datetime",
          "description": "Timestamp of last message"
        },
        "metadata": {
          "type": "object",
          "description": "Optional conversation metadata",
          "properties": {
            "name": {
              "type": "string",
              "maxLength": 128
            },
            "description": {
              "type": "string",
              "maxLength": 512
            },
            "avatar": {
              "type": "ref",
              "ref": "#blobRef"
            }
          }
        }
      }
    },
    "messageView": {
      "type": "object",
      "description": "View of an MLS message",
      "required": ["id", "convoId", "sender", "ciphertext", "epoch", "createdAt"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Message identifier (TID)"
        },
        "convoId": {
          "type": "string",
          "description": "Conversation identifier"
        },
        "sender": {
          "type": "string",
          "format": "did",
          "description": "DID of message sender"
        },
        "ciphertext": {
          "type": "string",
          "description": "Base64-encoded MLS ciphertext"
        },
        "epoch": {
          "type": "integer",
          "minimum": 0,
          "description": "MLS epoch when message was sent"
        },
        "createdAt": {
          "type": "string",
          "format": "datetime",
          "description": "Message creation timestamp"
        },
        "contentType": {
          "type": "string",
          "description": "MIME type of decrypted content",
          "default": "text/plain"
        },
        "attachments": {
          "type": "array",
          "items": {
            "type": "ref",
            "ref": "#blobRef"
          },
          "description": "Message attachments",
          "maxLength": 10
        }
      }
    },
    "memberView": {
      "type": "object",
      "description": "View of a conversation member",
      "required": ["did", "joinedAt"],
      "properties": {
        "did": {
          "type": "string",
          "format": "did",
          "description": "Member DID"
        },
        "joinedAt": {
          "type": "string",
          "format": "datetime",
          "description": "When member joined"
        },
        "leafIndex": {
          "type": "integer",
          "minimum": 0,
          "description": "MLS leaf index in tree"
        },
        "credential": {
          "type": "string",
          "description": "Base64-encoded MLS credential"
        }
      }
    },
    "keyPackageRef": {
      "type": "object",
      "description": "Reference to an MLS key package",
      "required": ["id", "did", "keyPackage", "cipherSuite", "createdAt"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Key package identifier"
        },
        "did": {
          "type": "string",
          "format": "did",
          "description": "Owner DID"
        },
        "keyPackage": {
          "type": "string",
          "description": "Base64-encoded MLS key package"
        },
        "cipherSuite": {
          "type": "ref",
          "ref": "#cipherSuiteEnum",
          "description": "Supported cipher suite"
        },
        "createdAt": {
          "type": "string",
          "format": "datetime",
          "description": "Key package creation time"
        },
        "expiresAt": {
          "type": "string",
          "format": "datetime",
          "description": "Key package expiration time"
        }
      }
    },
    "blobRef": {
      "type": "object",
      "description": "Reference to a blob (file attachment)",
      "required": ["cid", "mimeType", "size"],
      "properties": {
        "cid": {
          "type": "string",
          "description": "Content identifier (CID)"
        },
        "mimeType": {
          "type": "string",
          "description": "MIME type of the blob",
          "maxLength": 256
        },
        "size": {
          "type": "integer",
          "minimum": 0,
          "maximum": 52428800,
          "description": "Blob size in bytes (max 50MB)"
        },
        "ref": {
          "type": "string",
          "format": "at-uri",
          "description": "AT URI reference to blob"
        }
      }
    },
    "epochInfo": {
      "type": "object",
      "description": "Information about an MLS epoch",
      "required": ["epoch", "groupId"],
      "properties": {
        "epoch": {
          "type": "integer",
          "minimum": 0,
          "description": "Epoch number"
        },
        "groupId": {
          "type": "string",
          "description": "MLS group identifier"
        },
        "memberCount": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of members in this epoch"
        },
        "updatedAt": {
          "type": "string",
          "format": "datetime",
          "description": "When epoch was created"
        }
      }
    },
    "cipherSuiteEnum": {
      "type": "string",
      "description": "MLS cipher suite enumeration",
      "knownValues": [
        "MLS_128_DHKEMX25519_AES128GCM_SHA256_Ed25519",
        "MLS_128_DHKEMP256_AES128GCM_SHA256_P256",
        "MLS_128_DHKEMX25519_CHACHA20POLY1305_SHA256_Ed25519",
        "MLS_256_DHKEMX448_AES256GCM_SHA512_Ed448",
        "MLS_256_DHKEMP521_AES256GCM_SHA512_P521",
        "MLS_256_DHKEMX448_CHACHA20POLY1305_SHA512_Ed448"
      ]
    }
  }
}
