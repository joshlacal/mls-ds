{
  "lexicon": 1,
  "id": "blue.catbird.mls.getMessages",
  "defs": {
    "main": {
      "type": "query",
      "description": "Retrieve messages from an MLS conversation. Messages are GUARANTEED to be returned in MLS sequential order (epoch ASC, seq ASC). Clients MUST process messages in this order for proper MLS decryption.",
      "parameters": {
        "type": "params",
        "required": ["convoId"],
        "properties": {
          "convoId": {
            "type": "string",
            "description": "Conversation identifier"
          },
          "limit": {
            "type": "integer",
            "minimum": 1,
            "maximum": 100,
            "default": 50,
            "description": "Maximum number of messages to return"
          },
          "sinceSeq": {
            "type": "integer",
            "minimum": 0,
            "description": "Fetch messages with seq > sinceSeq (pagination cursor). Use lastSeq from previous response."
          }
        }
      },
      "output": {
        "encoding": "application/json",
        "schema": {
          "type": "object",
          "required": ["messages"],
          "properties": {
            "messages": {
              "type": "array",
              "items": {
                "type": "ref",
                "ref": "blue.catbird.mls.defs#messageView"
              },
              "description": "Messages in MLS sequential order (epoch ASC, seq ASC). Clients MUST process in this order."
            },
            "lastSeq": {
              "type": "integer",
              "description": "Sequence number of the last message in this response. Use as sinceSeq for next page. Omitted if no messages returned."
            },
            "gapInfo": {
              "type": "ref",
              "ref": "#gapInfo",
              "description": "Gap detection metadata for missing messages. Omitted if no gaps detected or conversation is empty."
            }
          }
        }
      },
      "errors": [
        {
          "name": "ConvoNotFound",
          "description": "Conversation not found"
        },
        {
          "name": "NotMember",
          "description": "Caller is not a member of the conversation"
        },
        {
          "name": "InvalidCursor",
          "description": "sinceSeq parameter is invalid or exceeds available messages"
        }
      ]
    },
    "gapInfo": {
      "type": "object",
      "description": "Metadata about missing sequence numbers in a conversation. Gaps can occur when members are removed from the conversation.",
      "required": ["hasGaps", "missingSeqs", "totalMessages"],
      "properties": {
        "hasGaps": {
          "type": "boolean",
          "description": "Whether there are gaps in the sequence number range"
        },
        "missingSeqs": {
          "type": "array",
          "items": {
            "type": "integer"
          },
          "description": "Array of missing sequence numbers within the conversation's min-max seq range. Empty if hasGaps is false."
        },
        "totalMessages": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of messages in the conversation (including gaps)"
        }
      }
    }
  }
}
