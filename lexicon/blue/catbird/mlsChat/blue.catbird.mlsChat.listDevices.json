{
  "lexicon": 1,
  "id": "blue.catbird.mlsChat.listDevices",
  "description": "List and manage registered devices (consolidates listDevices + deleteDevice)",
  "defs": {
    "main": {
      "type": "query",
      "description": "List all registered devices for the authenticated user with key package counts and last seen timestamps. To remove a device, use the blue.catbird.mlsChat.registerDevice endpoint with the same deviceUUID (server handles cleanup), or call this endpoint with a DELETE method and deviceId parameter.",
      "parameters": {
        "type": "params",
        "properties": {
          "deviceId": {
            "type": "string",
            "description": "Optional: when provided with DELETE method, removes this device and its key packages"
          }
        }
      },
      "output": {
        "encoding": "application/json",
        "schema": {
          "type": "object",
          "required": ["devices"],
          "properties": {
            "devices": {
              "type": "array",
              "items": {
                "type": "ref",
                "ref": "#deviceInfo"
              },
              "description": "List of user's registered devices, ordered by last seen (most recent first)"
            }
          }
        }
      }
    },
    "deviceInfo": {
      "type": "object",
      "required": ["deviceId", "deviceName", "credentialDid", "lastSeenAt", "registeredAt", "keyPackageCount"],
      "properties": {
        "deviceId": {
          "type": "string",
          "description": "Server-generated device ID (UUID)"
        },
        "deviceName": {
          "type": "string",
          "description": "Human-readable device name (e.g., 'Josh's iPhone')"
        },
        "deviceUUID": {
          "type": "string",
          "description": "Persistent device UUID (if provided during registration)"
        },
        "credentialDid": {
          "type": "string",
          "description": "Full device credential DID (did:plc:user#device-uuid)"
        },
        "lastSeenAt": {
          "type": "string",
          "format": "datetime",
          "description": "Timestamp of last device activity"
        },
        "registeredAt": {
          "type": "string",
          "format": "datetime",
          "description": "Timestamp when device was first registered"
        },
        "keyPackageCount": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of available (unconsumed) key packages for this device"
        },
        "pushTokenRegistered": {
          "type": "boolean",
          "description": "Whether this device has a push token registered"
        }
      }
    }
  }
}
