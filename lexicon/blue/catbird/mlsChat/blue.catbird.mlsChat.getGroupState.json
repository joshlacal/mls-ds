{
  "lexicon": 1,
  "id": "blue.catbird.mlsChat.getGroupState",
  "description": "Retrieve group state including GroupInfo, epoch, and welcome data (consolidates getGroupInfo + getEpoch + validateWelcome)",
  "defs": {
    "main": {
      "type": "query",
      "description": "Fetch MLS group state for a conversation. The 'include' parameter selects which state components to return, reducing multiple round-trips to a single call.",
      "parameters": {
        "type": "params",
        "required": ["convoId"],
        "properties": {
          "convoId": {
            "type": "string",
            "description": "Conversation identifier"
          },
          "include": {
            "type": "string",
            "description": "Comma-separated list of state components to include: 'groupInfo' (TLS-serialized GroupInfo for external commit), 'welcome' (pending Welcome message), 'epoch' (current epoch number). Defaults to 'groupInfo,epoch'.",
            "default": "groupInfo,epoch"
          }
        }
      },
      "output": {
        "encoding": "application/json",
        "schema": {
          "type": "object",
          "properties": {
            "groupInfo": {
              "type": "string",
              "description": "Base64-encoded TLS-serialized GroupInfo (present when 'groupInfo' included)"
            },
            "epoch": {
              "type": "integer",
              "minimum": 0,
              "description": "Current MLS epoch number (present when 'epoch' included)"
            },
            "welcome": {
              "type": "string",
              "description": "Base64-encoded pending MLS Welcome message (present when 'welcome' included and a Welcome exists)"
            },
            "expiresAt": {
              "type": "string",
              "format": "datetime",
              "description": "When the GroupInfo becomes stale (typically 5 minutes)"
            }
          }
        }
      },
      "errors": [
        {"name": "NotFound", "description": "Conversation not found"},
        {"name": "Unauthorized", "description": "Not a current or past member"},
        {"name": "GroupInfoUnavailable", "description": "GroupInfo not yet generated for this conversation"}
      ]
    }
  }
}
